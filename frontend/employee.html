<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee</title>
</head>
<body>
    <button type="button">
      <a href="/frontend/main.html">Home</a>
    </button>


    <h1>Employee Data</h1>

          <!-- this is the search form -->
    <form>
      Search: <input type="text" id="searchid" placeholder="Employee ID..">
    <!-- this is button to Find -->
      <button type="button" onclick="searchEmployee()">Find</button>
    
    </form>

          <!-- This is the employee table -->
    <table id="employee-table">
      <thead>
        <tr>
          <th>Employee ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Option</th>
        </tr>
      </thead>
      <tbody id="employee-list"></tbody>
      <!-- this is the button to SHOW FORM for add Employee -->
      <button id="show-form-to-add-employee">Add</button>
    </table>

          <!-- This is the form -->
    <form id="from-to-add">
      <!-- form -->
      <label for="eid">Eid</label>
      <input type="text" id="eid" name="id" required>
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required>
      <label for="phone">Phone:</label>
      <input type="text" id="phone" name="phone" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      <!-- button to submit for add -->
      <button type="submit">Submit</button>
    </form>

    <!-- Success message element -->
    <div id="success-message" style="display:none">Data posted successfully</div>

    <script>

          // SEARCH and SHOW Data
      function searchEmployee(){
        const search = document.getElementById('searchid').value;
        if (search == '*') {
        // pull the data from api
        fetch('http://127.0.0.1:5000/employee?eid=*')
          .then(response => response.json())
          .then(data => {
            const employeeList = document.getElementById('employee-list');
            employeeList.innerHTML = ''; // Clean all data table after add the new data
            data.forEach(employee => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${employee.eid}</td>
                <td>${employee.name}</td>
                <td>${employee.phone}</td>
                <td>${employee.email}</td>
                <td><button>Edit</button><button data-eid="${employee.eid}">Delete</button></td>
              `;
              employeeList.appendChild(tr);
            });
          })
            .catch(error => console.error(error));
    } else {
      // pull the data from api for the specific eid
      fetch(`http://127.0.0.1:5000/employee?eid=${search}`)
        .then(response => response.json())
            .then(data => {
              const employee = data;
              const employeeList = document.getElementById('employee-list');
              employeeList.innerHTML ='';// Clean all data table after add the new data
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${employee.eid}</td>
                <td>${employee.name}</td>
                <td>${employee.phone}</td>
                <td>${employee.email}</td>
                <td><button>Edit</button><button data-eid="${employee.eid}">Delete</button></td>
              `;
              employeeList.appendChild(tr);
            })
            .catch(error => console.error(error));
            } 
  }
          // ADD Data

      const Show_Form = document.getElementById('show-form-to-add-employee');

      // Get a reference to the form element
      const form = document.getElementById('from-to-add');

      const isFormVisible = localStorage.getItem('isFormVisible') === 'true';
      if (isFormVisible) {
        form.style.display = 'block';
      } else{
        form.style.display='none';
      }
      Show_Form.addEventListener('click', event=>{
        form.style.display = (form.style.display === 'none') ? 'block' : 'none';
        localStorage.setItem('isFormVisible', form.style.display === 'block');
      });
      // Handle form submission
      form.addEventListener('submit', event => {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Define the API endpoint URL
        const apiEndpoint = 'http://127.0.0.1:5000/employee?eid=*';

        // Define the data to post to the API as a JavaScript object
        const postData = {
          eid: form.elements.eid.value,
          name: form.elements.name.value,
          phone: form.elements.phone.value,
          email: form.elements.email.value
        };

        // Define the options for the fetch() function
        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(postData)
        };

        // Send the HTTP POST request to the API endpoint using fetch()
        fetch(apiEndpoint, options)
          .then(response => {
            if (response.ok) {
              const successMessage = document.getElementById('success-message');
              successMessage.style.display = 'block';
              document.getElementById('form-to-add').reset();
              setTimeout(() => {successMessage.innerHTML = '';}, 2000);
              return response.json();
            } else {
              throw new Error('Failed to post data to API.');
            }
          })
          .then(data => {
            console.log('Data posted to API:', data);
            // Do something with the response data, if needed
          })
          .catch(error => {
            console.error(error);
            // Handle errors that occurred during the request
          });
      });

            // DELETE data
        function deleteEmployee(eid) {
        // Send a DELETE request to the API with the eid value
        fetch(`http://127.0.0.1:5000/employee`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({eid: eid})
        })
        .then(response => {
          // If the request is successful, remove the corresponding table row
          const row = document.querySelector(`#employee-list tr[data-eid="${eid}"]`);
          row.parentNode.removeChild(row);
        })
        .catch(error => console.error(error));
      }

      // Add an event listener to the employee list table
      const employeeList = document.getElementById('employee-list');
      employeeList.addEventListener('click', (event) => {
        const target = event.target;
        // Check if the clicked element is a delete button
        if (target.tagName === 'BUTTON' && target.textContent === 'Delete') {
          const eid = target.getAttribute('data-eid');
          const deleteButton = event.target;
          deleteButton.addEventListener('mouseover', () => {
            const deleteMessage = document.getElementById('success-message');
            deleteMessage.style.display = 'block';
            setTimeout(() => {deleteMessage.style.display = 'none';}, 2000);
          });
          deleteEmployee(eid);
        }
      });
          // PUT Data 
      
    </script>
</body>
</html>